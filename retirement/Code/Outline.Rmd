---
title: 'ISDA 609 - Mathematical Modeling Techniques for Data Analytics'
author: "Partha Banerjee, Rohan Fray, Vincent Ying"
date: "November 19, 2014"
output:
  pdf_document:
    highlight: tango
    toc: yes
    toc_depth: 4
  html_document:
    theme: united
    toc: yes
geometry: margin=0.6in
fontsize: 11pt
---

\pagebreak

```{r clear, include=FALSE, echo=FALSE}
# Added this "clear all" section to make sure we can run use "Chunks/Run All"" without conflict.
# Still does not catch package info, but that will be seen when knit.

# Start with a Clean memory
rm(list=ls())

# Supress warnings particularly during loading of libraries
options(warn=-1)
```

```{r config, echo=FALSE, results='hide'}
# Library and Directory Config

# Add all required packages here. 
required.packages <- c("plyr", 
                       "ggplot2",
                       "gdata")

# Check to see if packages in required.packages are installed
have.pkgs <- required.packages %in% installed.packages()

if(length(required.packages) > sum(have.pkgs)){
  install.packages(required.packages[!have.pkgs])
}

for(pkg in required.packages){
  library(pkg, character.only = TRUE, quietly=TRUE, warn.conflicts=FALSE)
}

# Make sure we're in the right working directory:  "Code"
if("Code" %in% list.files()){
  setwd("Code")
}

if(!("Code" %in% list.files("..")))
{
  stop
}
```


## Problem Definition: Final Project #2     
        
### Project 9.4.2 (page 376): Camparison of 401K VS Social Security for Retirement
        
Retirement and Social Security. Should US citizens build their own retirement through 401Ks or use the current Social Security program?  Build models to be able to compare these systems and provide decisions that can help someone to plan a better retirement.     
        
**Problem Statement:**        
This purpose of this project is to determine the best way to maximize savings for retirement. 401K investment returns and Social Security payout from contributions will be analyzed and compared.      
                
### Load Data

```{r data}
# SSA Dataset (Taken from supplement13.xlsx)
ssa_taxrate = read.csv("../Data/OASDI - Table 2.A3 - Annual max taxable earnings and contribution rates.csv")
ssa_taxamt = read.csv("../Data/OASDI - Table 2.A4 - Maximum annual contribution.csv")
ssa_benefit = read.csv("../Data/OASDI - Table 6.B3 - All Benefit.csv")


age <- c(62, 63, 64, 65, 66, 67, 68, 69, 70)

# SSA - Average montly benefit from 2012
#   supplement13, Table 6.B3 
#   and http://www.ssa.gov/OACT/ProgData/ar_drc.html
mth_amt <- c(1103.9, 1182.75,	1261.6,	1366.62, 1471.81,	1577, 1703.16, 1829.32, 1955.48)
ssa_benefit <- data.frame(age, mth_amt)

# 401k - Base mount accumulated from contribution
#   https://blog.personalcapital.com/financial-planning-2/average-401k-balance-age/
tot_low <- c(690500, 708000, 725500, 743000,	760500, 778000, 795500, 813000, 830500)
# 401k - Balance with 7% compound interest
#   http://www.investor.gov/tools/calculators/compound-interest-calculator
tot_high <- c(3613402, 3883840, 4173209, 4482834,  4814132, 5168621, 5547925, 5953779, 6388044)
k_Balance <- data.frame(age, tot_low, tot_high)
```

### Assuming life expectancy of 85.45 for modeling:

```{r}
# Calculate SSA Total Benefit with Average Death at 85.45
ssa_benefit$tot_amt <- (85.45-ssa_benefit$age) * 12 * ssa_benefit$mth_amt

# Calculate 401k Monthly Benefit with Base Balance
k_Balance$mth_low <- k_Balance$tot_low / (85.45-k_Balance$age) / 12
# Calculate 401k Monthly Benefit with 7% Increase
k_Balance$mth_high <- k_Balance$tot_high / (85.45-k_Balance$age) / 12
```

### Comparison of SSA and 401k return.

Assumptions for comparison:

- Start work at age 22.
- Average life expectency till 85.45 for those reaching 65 in 2014.
- Use average SSA benefit from 2012
- Start contributing to 401k from age 22 with contributions the same amount as SSA contribution.
- Use 7% compound growth for 401k contributions.


```{r}
# SSA Ratios of Benefit To Contribution According to Age
#ratio_ssa <- ssa_benefit$tot_amt / "TOTAL CONTRIBUTION"

# 401k Ratios of Benefit To Contribution According to Age
ratio_401k <- k_Balance$tot_high / k_Balance$tot_low

#plot(ssa_benefit$age, ratio_ssa)
plot(k_Balance$age, ratio_401k)
```

### Modeling:       
        
Problem:

- When to start retirement?
- When to start withdrawing from SSA?


Assumptions for modeling problem:

- Start work at age 22.
- Average life expectency till 85.45 for those reaching 65 in 2014.
- Using average SSA benefit from 2012
- Start contributing to 401k from age 22 with an inital contribution of $8,000 and $17,500 every year after.
- Use 7% compound growth for 401k contributions.


Models: Optimization of Discrete Models with Simplex Method      

```{r}
# Combined benefit when withdrawing 401k at 62 and delaying SSA
tot_amt <- ssa_benefit$tot_amt + k_Balance[k_Balance$age==62,]$tot_high
mth_amt <- tot_amt / (85.45 * 12)
combin <- data.frame(age, mth_amt, tot_amt)

# Combined benefits from SSA and 401k
plot(combin$age, combin$mth_amt)
plot(combin$age, combin$tot_amt)


# Combined benefit when contributing to 401k until start of SSA
tot_amt <- ssa_benefit$tot_amt + k_Balance$tot_high
mth_amt <- tot_amt / (85.45 * 12)
combin_401contrib <- data.frame(age, mth_amt, tot_amt)

# Combined benefits from SSA and 401k
plot(combin_401contrib$age, combin$mth_amt)
plot(combin_401contrib$age, combin$tot_amt)
```
